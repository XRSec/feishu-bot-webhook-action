name: Example Workflow

on:
  push:
    branches: [ main ]
  pull_request:
    types: [ opened, synchronize, closed ]
  workflow_dispatch:
    inputs:
      custom_message:
        description: 'è¿™æ˜¯ä¸€ä¸ªæŒ‰é’®'
        required: false
        default: 'è¿™æ˜¯ä¸€ä¸ªè¾“å…¥æ¡†'

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  notify:
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch'
    steps:
      - uses: actions/checkout@v4
      - name: Send notification to Feishu
        uses: ./
        with:
          FEISHU_BOT_WEBHOOK: ${{ secrets.FEISHU_BOT_WEBHOOK }}
          FEISHU_BOT_SIGNKEY: ${{ secrets.FEISHU_BOT_SIGNKEY }}
          MSG_TEXT: |
            æ ‡å‡†emoji ğŸ˜ğŸ˜¢ğŸŒğŸ’¼ğŸ†âŒâœ…
            é£ä¹¦emoji :OK::THUMBSUP:
              *æ–œä½“* **ç²—ä½“** ~~åˆ é™¤çº¿~~
              <font color='red'>è¿™æ˜¯çº¢è‰²æ–‡æœ¬</font>
              <text_tag color='blue'>æ ‡ç­¾</text_tag>
              [æ–‡å­—é“¾æ¥](/ssl:ttdoc/home/index)
              <link icon='chat_outlined' url='https://open.feishu.cn' pc_url='' ios_url='' android_url=''>å¸¦å›¾æ ‡çš„é“¾æ¥</link>
              <at id=all></at>
            
            æ— åºåˆ—è¡¨:
              - é¡¹ç›®ä¸€
              - é¡¹ç›®äºŒ
                - å­é¡¹ç›® a
                - å­é¡¹ç›® b
            
            æœ‰åºåˆ—è¡¨:
              1. ç¬¬ä¸€é¡¹
              2. ç¬¬äºŒé¡¹
              1. å­é¡¹ 2.1
              2. å­é¡¹ 2.2
            
            ä»£ç å—:
              ```javascript
              // JavaScript ä»£ç ç¤ºä¾‹
              function hello(name) {
              console.log('Hello, ' + name);
            }
              hello('Feishu');
              ```
            
            æ°´å¹³åˆ†å‰²çº¿:
            ---
              
              æ¢è¡Œï¼šåœ¨è¡Œæœ«åŠ ä¸¤ä¸ªç©ºæ ¼ç„¶åå›è½¦
              æˆ–ä½¿ç”¨ HTML æ¢è¡Œï¼š<br/>
            
            å›¾ç‰‡ï¼ˆMarkdownï¼‰: éœ€è¦ imagekey [å‚è€ƒé£ä¹¦æ–‡æ¡£](https://open.feishu.cn/document/feishu-cards/card-components/content-components/rich-text)
            
            å›¾ç‰‡ï¼ˆHTMLï¼‰:
              <img src="https://lf-package-cn.feishucdn.com/obj/feishu-static/lark/open/doc/frontend/favicon.png" alt="æ›¿ä»£æ–‡å­—" />
            
            æŒ‰é’®/æ“ä½œï¼ˆå¡ç‰‡å†…é€šå¸¸ç”¨æŒ‰é’®ç»„ä»¶ï¼Œè¿™é‡Œç¤ºä¾‹ linkï¼‰:
              <link icon='external' url='https://open.feishu.cn' pc_url='' ios_url='' android_url=''>æ‰“å¼€é£ä¹¦å®˜ç½‘</link>
              
              å¤‡æ³¨ï¼š
            - éƒ¨åˆ†å¯Œæ–‡æœ¬ç‰¹æ€§ï¼ˆæ¯”å¦‚å¤é€‰æ¡†ã€è¡¨æ ¼æˆ–å›¾ç‰‡çš„æ”¯æŒä¸å±•ç¤ºæ ·å¼ï¼‰ä¼šä¾èµ–é£ä¹¦å¡ç‰‡çš„å…·ä½“æ¸²æŸ“ç¯å¢ƒä¸ç‰ˆæœ¬ï¼Œè‹¥æœ‰æŸäº›åœ¨å®é™…å¡ç‰‡ä¸­ä¸ç”Ÿæ•ˆï¼Œæˆ‘å¯ä»¥å¸®ä½ æŠŠå¯¹åº”å†…å®¹æ”¹å†™æˆå¡ç‰‡ç»„ä»¶ï¼ˆæ¯”å¦‚æŠŠä»»åŠ¡æ”¹æˆ actions æŒ‰é’®æˆ–æŠŠå›¾ç‰‡æ¢ä¸º image ç»„ä»¶ï¼‰çš„ç¤ºä¾‹ JSONã€‚

  notify-on-push:
    runs-on: ubuntu-latest
    if: github.event_name == 'push'
    steps:
      - uses: actions/checkout@v4
      - name: Send push notification to Feishu
        uses: ./
        with:
          FEISHU_BOT_WEBHOOK: ${{ secrets.FEISHU_BOT_WEBHOOK }}
          FEISHU_BOT_SIGNKEY: ${{ secrets.FEISHU_BOT_SIGNKEY }}
          # ä¸è®¾ç½® MSG_TEXT, å°†å‘é€æ¨¡æ¿æ¶ˆæ¯
  del_runs:
    runs-on: ubuntu-latest
    steps:
      - name: Delete workflow runs
        uses: Mattraks/delete-workflow-runs@main
        with:
          token: ${{ env.GITHUB_TOKEN }}
          repository: ${{ github.repository }}
          retain_days: ${{ github.event.inputs.days }}
          keep_minimum_runs: 3
